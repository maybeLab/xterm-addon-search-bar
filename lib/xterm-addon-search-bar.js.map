{"version":3,"file":"xterm-addon-search-bar.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.ts"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { ITerminalAddon, Terminal } from 'xterm';\nimport { ISearchOptions, SearchAddon } from 'xterm-addon-search';\nimport './index.css'\n\nexport interface SearchBarOption extends ISearchOptions {\n  searchAddon: SearchAddon;\n}\n\nconst ADDON_MARKER_NAME = 'xterm-search-bar__addon';\n\nexport class SearchBarAddon implements ITerminalAddon {\n  private readonly options: Partial<SearchBarOption>;\n  private terminal: Terminal;\n  private readonly searchAddon: SearchAddon;\n  private searchBarElement: HTMLDivElement;\n  private searchKey: string;\n\n  constructor(options: Partial<SearchBarOption>) {\n    this.options = options || {};\n    if (this.options && this.options.searchAddon) {\n      this.searchAddon = this.options.searchAddon;\n    }\n  }\n\n  activate(terminal: Terminal): void {\n    this.terminal = terminal;\n    if (!this.searchAddon) {\n      console.error('Cannot use search bar addon until search addon has been loaded!');\n    }\n  }\n\n\n  dispose() {\n    this.hidden();\n  }\n\n  /**\n   *  Show the bar in the term\n   * @returns empty\n   * @memberof SearchBarAddon  necessary search addon instance\n   */\n  show() {\n    if (!this.terminal || !this.terminal.element) {\n      return;\n    }\n    if (this.searchBarElement) {\n      this.searchBarElement.style.visibility = 'visible';\n      (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\n      return;\n    }\n\n    this.terminal.element.style.position = 'relative';\n    const element = document.createElement('div');\n    element.innerHTML = `\n       <input type=\"text\" class=\"search-bar__input\" name=\"search-bar__input\"/>\n       <button class=\"search-bar__btn prev\"></button>\n       <button class=\"search-bar__btn next\"></button>\n       <button class=\"search-bar__btn close\"></button>\n    `;\n    element.className = ADDON_MARKER_NAME;\n    const parentElement = <HTMLElement>this.terminal.element.parentElement;\n    this.searchBarElement = element;\n    if (!['relative', 'absoulte', 'fixed'].includes(parentElement.style.position)) {\n      parentElement.style.position = 'relative';\n    }\n    parentElement.appendChild(this.searchBarElement);\n    this.on('.search-bar__btn.close', 'click', () => {\n      this.hidden();\n    });\n    this.on('.search-bar__btn.next', 'click', () => {\n      this.searchAddon.findNext(this.searchKey, {\n        incremental: false\n      });\n    });\n    this.on('.search-bar__btn.prev', 'click', () => {\n      this.searchAddon.findPrevious(this.searchKey, {\n        incremental: false\n      });\n    });\n    this.on('.search-bar__input', 'keyup', (e: any) => {\n      this.searchKey = (e.target as HTMLInputElement).value;\n      this.searchAddon.findNext(this.searchKey, {\n        incremental: e.key !== `Enter`\n      });\n    });\n    (this.searchBarElement.querySelector('input') as HTMLInputElement).select();\n  }\n\n  /**\n   * You can manually call close, also can click the close button on the bar\n   * @memberof SearchBarAddon\n   */\n  hidden() {\n    if (this.searchBarElement && (this.terminal.element as HTMLElement).parentElement) {\n      this.searchBarElement.style.visibility = 'hidden';\n    }\n  }\n\n  private on(selector: string, event: string, cb: (e: any) => void) {\n    const parentElement = <HTMLElement>(this.terminal.element as HTMLElement).parentElement;\n    parentElement.addEventListener(event, (e) => {\n      let target = e.target;\n\n      while (target !== document.querySelector(selector)) {\n        if (target === parentElement) {\n          target = null;\n          break;\n        }\n\n        target = (target as HTMLElement).parentElement;\n      }\n\n      if (target === document.querySelector(selector)) {\n        cb.call(this, e);\n        e.stopPropagation();\n      }\n    });\n  }\n\n  /**\n   * You can customize your own style, and then add CSS string template after search bar init\n   * @param {string} newStyle\n   * @memberof SearchBarAddon\n   */\n  addNewStyle(newStyle: string) {\n    let styleElement = document.getElementById(ADDON_MARKER_NAME) as HTMLStyleElement;\n\n    if (!styleElement) {\n      styleElement = document.createElement('style');\n      styleElement.type = 'text/css';\n      styleElement.id = ADDON_MARKER_NAME;\n      document.getElementsByTagName('head')[0].appendChild(styleElement);\n    }\n\n    styleElement.appendChild(document.createTextNode(newStyle));\n  }\n}\n"],"names":[],"mappings":"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"}